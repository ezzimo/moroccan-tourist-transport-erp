# ------------------------------------------------
#  NGINX â€“ Tourist ERP Front-end (React + APIs)
# ------------------------------------------------
server {
    listen 80;
    server_name _;

    # ----------------------------------------------------------
    # 1.  Static assets / client-side routes (React build)
    # ----------------------------------------------------------
    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # ----------------------------------------------------------
    # 2.  Helper: standard proxy headers (just a comment ðŸ˜Š)
    # ----------------------------------------------------------
    #  proxy_set_header Host              $host;
    #  proxy_set_header X-Real-IP         $remote_addr;
    #  proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
    #  proxy_set_header X-Forwarded-Proto $scheme;

    # -------------------------------------------------
    # 3.  Micro-service API entry points (longest
    #     prefix wins â†’ place before catch-all)
    # -------------------------------------------------
    location /api/v1/auth/ {
        proxy_pass http://auth_service:8000;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/v1/booking/ {
        rewrite ^/api/v1/booking/(.*)$ /api/v1/$1 break;
        proxy_pass http://booking_service:8002;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/v1/crm/ {
        rewrite ^/api/v1/crm/(.*)$ /api/v1/$1 break;
        proxy_pass http://crm_service:8001;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/v1/driver/ {
        rewrite ^/api/v1/driver/(.*)$ /api/v1/$1 break;
        proxy_pass http://driver_service:8003;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/v1/financial/ {
        rewrite ^/api/v1/financial/(.*)$ /api/v1/$1 break;
        proxy_pass http://financial_service:8005;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/v1/fleet/ {
        rewrite ^/api/v1/fleet/(.*)$ /api/v1/$1 break;
        proxy_pass http://fleet_service:8004;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/v1/hr/ {
        rewrite ^/api/v1/hr/(.*)$ /api/v1/$1 break;
        proxy_pass http://hr_service:8006;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/v1/inventory/ {
        rewrite ^/api/v1/inventory/(.*)$ /api/v1/$1 break;
        proxy_pass http://inventory_service:8007;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/v1/notification/ {
        rewrite ^/api/v1/notification/(.*)$ /api/v1/$1 break;
        proxy_pass http://notification_service:8008;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/v1/qa/ {
        rewrite ^/api/v1/qa/(.*)$ /api/v1/$1 break;
        proxy_pass http://qa_service:8009;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /api/v1/tour/ {
        rewrite ^/api/v1/tour/(.*)$ /api/v1/$1 break;
        proxy_pass http://tour_service:8010;
        proxy_set_header Host              $host;
        proxy_set_header X-Real-IP         $remote_addr;
        proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
